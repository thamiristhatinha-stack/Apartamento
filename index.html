<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apzinho 92 - Thamirinha & Felipinho</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyAeFtVA7Yg-DD8knaa9OxCPSoRnBKiUINk",
            authDomain: "apartamento-d328e.firebaseapp.com",
            projectId: "apartamento-d328e",
            storageBucket: "apartamento-d328e.firebasestorage.app",
            messagingSenderId: "206733797802",
            appId: "1:206733797802:web:52fe508854e1c0d09d63d3"
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'apartamento-d328e-prod';
        const docPath = ["artifacts", appId, "public", "data", "finance_tracker", "finance-main"];

        const cronogramaOficial = [
            { etapa: 1, data: '26/09/2025', percMes: 4.20, percAcum: 4.20, pago: true, valorPago: 184.57 },
            { etapa: 2, data: '21/10/2025', percMes: 2.10, percAcum: 6.30, pago: true, valorPago: 224.90 },
            { etapa: 3, data: '21/11/2025', percMes: 1.01, percAcum: 7.31, pago: true, valorPago: 274.23 },
            { etapa: 4, data: '22/12/2025', percMes: 1.88, percAcum: 9.19, pago: true, valorPago: 287.42 },
            { etapa: 5, data: '22/01/2026', percMes: 0.01, percAcum: 9.20 },
            { etapa: 6, data: '22/02/2026', percMes: 3.50, percAcum: 12.70 },
            { etapa: 7, data: '22/03/2026', percMes: 2.00, percAcum: 14.70 },
            { etapa: 8, data: '22/04/2026', percMes: 3.20, percAcum: 17.90 },
            { etapa: 9, data: '22/05/2026', percMes: 6.50, percAcum: 24.40 },
            { etapa: 10, data: '22/06/2026', percMes: 7.40, percAcum: 31.80 },
            { etapa: 11, data: '22/07/2026', percMes: 6.10, percAcum: 37.90 },
            { etapa: 12, data: '22/08/2026', percMes: 2.10, percAcum: 40.00 },
            { etapa: 13, data: '22/09/2026', percMes: 2.70, percAcum: 42.70 },
            { etapa: 14, data: '22/10/2026', percMes: 2.70, percAcum: 45.40 },
            { etapa: 15, data: '22/11/2026', percMes: 3.20, percAcum: 48.60 },
            { etapa: 16, data: '22/12/2026', percMes: 3.70, percAcum: 52.30 },
            { etapa: 17, data: '22/01/2027', percMes: 3.30, percAcum: 55.60 },
            { etapa: 18, data: '22/02/2027', percMes: 3.50, percAcum: 59.10 },
            { etapa: 19, data: '22/03/2027', percMes: 4.25, percAcum: 63.35 },
            { etapa: 20, data: '22/04/2027', percMes: 4.25, percAcum: 67.60 },
            { etapa: 21, data: '23/05/2027', percMes: 4.50, percAcum: 72.10 },
            { etapa: 22, data: '22/06/2027', percMes: 3.50, percAcum: 75.60 },
            { etapa: 23, data: '22/07/2027', percMes: 4.65, percAcum: 80.25 },
            { etapa: 24, data: '22/08/2027', percMes: 4.00, percAcum: 84.25 },
            { etapa: 25, data: '22/09/2027', percMes: 2.35, percAcum: 86.60 },
            { etapa: 26, data: '22/10/2027', percMes: 1.15, percAcum: 87.75 },
            { etapa: 27, data: '22/11/2027', percMes: 1.20, percAcum: 88.95 },
            { etapa: 28, data: '22/12/2027', percMes: 1.10, percAcum: 90.05 },
            { etapa: 29, data: '24/01/2028', percMes: 1.00, percAcum: 91.05 },
            { etapa: 30, data: '22/02/2028', percMes: 0.75, percAcum: 91.80 },
            { etapa: 31, data: '22/03/2028', percMes: 0.50, percAcum: 92.30 },
            { etapa: 32, data: '24/04/2028', percMes: 0.65, percAcum: 92.95 },
            { etapa: 33, data: '22/05/2028', percMes: 0.80, percAcum: 93.75 },
            { etapa: 34, data: '22/06/2028', percMes: 0.65, percAcum: 94.40 },
            { etapa: 35, data: '24/07/2028', percMes: 0.60, percAcum: 95.00 },
            { etapa: 36, data: '22/08/2028', percMes: 5.00, percAcum: 100.00 }
        ];

        let firebaseApp, auth, db;
        
        const defaultData = {
            config: {
                valorApartamento: 255883.47,
                totalFinanciamento: 218149.62,
                totalEntrada: 37733.85,
                saldoInicial: 4999.90,
                previstoEvo: 10567.14,
                percObraMedido: 9.19
            },
            payments: cronogramaOficial.map(item => ({
                month: item.data.split('/')[1] + '/' + item.data.split('/')[2].slice(-2),
                entrada_pago: 0,
                evo_pago: item.valorPago || 0
            })),
            anuais: [
                { id: 1, label: 'Anual 1 (Dez/25)', valor: 2500.00, pago: true },
                { id: 2, label: 'Anual 2 (Dez/26)', valor: 2500.00, pago: false },
                { id: 3, label: 'Anual 3 (Dez/27)', valor: 2500.00, pago: false }
            ],
            poupanca: { valorAtual: 0 }
        };

        let currentData = defaultData;
        let showAllEvo = false;
        let showAllEntrada = false;

        window.saveDataCloud = async function() {
            if (!auth?.currentUser) return;
            try { await setDoc(doc(db, ...docPath), currentData); } catch (e) { console.error(e); }
        };

        window.toggleShowAllEvo = () => { showAllEvo = !showAllEvo; renderAll(); };
        window.toggleShowAllEntrada = () => { showAllEntrada = !showAllEntrada; renderAll(); };

        window.updateField = (i, field, val) => {
            currentData.payments[i][field] = parseFloat(val) || 0;
            window.saveDataCloud();
            renderAll();
        };

        window.updateCofrinho = (val) => {
            currentData.poupanca.valorAtual = parseFloat(val) || 0;
            window.saveDataCloud();
            renderAll();
        };

        window.toggleAnual = (idx) => {
            currentData.anuais[idx].pago = !currentData.anuais[idx].pago;
            if(currentData.anuais[idx].pago) confetti({ particleCount: 40, colors: ['#fbbf24'] });
            window.saveDataCloud();
            renderAll();
        };

        // Fun√ß√£o para atualizar progresso da obra com efeitos
        window.updateObraPerc = (newVal) => {
            const oldVal = currentData.config.percObraMedido || 0;
            const val = parseFloat(newVal);
            currentData.config.percObraMedido = val;
            
            // L√≥gica de confetes a cada 5%
            const oldMilestone = Math.floor(oldVal / 5);
            const newMilestone = Math.floor(val / 5);
            
            if (newMilestone > oldMilestone && val > 0) {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ec4899', '#a855f7', '#fbbf24']
                });
                showMotiveMessage(val);
            }

            window.saveDataCloud();
            renderAll();
        };

        const motiveMessages = [
            "Cada tijolo conta! O sonho est√° subindo! üè†",
            "Mais um degrau rumo ao nosso cantinho! ‚ú®",
            "Deus √© fiel em cada detalhe dessa obra! üôå",
            "Olha s√≥ como est√° ficando lindo! Nosso 92! ‚ù§Ô∏è",
            "Falta menos que ontem! Vamos Thami e Felipe! üí™",
            "Onde houver amor, haver√° um lar. Quase l√°! üóùÔ∏è",
            "Celebrando cada conquista do nosso Apzinho! ü•Ç"
        ];

        function showMotiveMessage(perc) {
            const msgBox = document.getElementById('motive-toast');
            const msgText = document.getElementById('motive-text');
            const randomMsg = motiveMessages[Math.floor(Math.random() * motiveMessages.length)];
            
            msgText.innerText = `Batemos ${perc.toFixed(0)}%! ${randomMsg}`;
            msgBox.classList.remove('translate-y-full', 'opacity-0');
            
            setTimeout(() => {
                msgBox.classList.add('translate-y-full', 'opacity-0');
            }, 5000);
        }

        async function initApp() {
            try {
                firebaseApp = initializeApp(firebaseConfig);
                auth = getAuth(firebaseApp);
                db = getFirestore(firebaseApp);
                const login = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else { await signInAnonymously(auth); }
                };
                await login();
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        onSnapshot(doc(db, ...docPath), (snap) => {
                            if (snap.exists()) { currentData = snap.data(); renderAll(); }
                            else { window.saveDataCloud(); }
                        }, (err) => console.error(err));
                    }
                });
            } catch (e) { console.error(e); }
        }

        window.addEventListener('load', initApp);
        window.getAppData = () => currentData;
        window.getCronograma = () => cronogramaOficial;
        window.getShowStates = () => ({ showAllEvo, showAllEntrada });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Nunito:wght@400;600;800&display=swap');
        :root { --pink-primary: #ec4899; --purple-primary: #a855f7; }
        body { font-family: 'Nunito', sans-serif; background-color: #fff5f7; color: #4a5568; overflow-x: hidden; }
        .bg-header { background: linear-gradient(135deg, var(--purple-primary) 0%, var(--pink-primary) 100%); }
        .card-shadow { box-shadow: 0 10px 30px -5px rgba(168, 85, 247, 0.15); border-radius: 1.5rem; }
        .input-editable { background: rgba(255,255,255,0.6); border: 1px solid #fee2e2; border-radius: 10px; padding: 6px; width: 100%; text-align: center; font-size: 13px; font-weight: 800; color: #333; }
        
        /* Barra de Progresso Interativa */
        .progress-container { height: 48px; background: #fdf2f8; border-radius: 16px; overflow: hidden; border: 3px solid #fce7f3; position: relative; cursor: pointer; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--pink-primary), var(--purple-primary)); transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .progress-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10; }
        
        .floating-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); padding: 8px 20px; border-radius: 30px; z-index: 100; display: flex; gap: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .floating-nav a { color: white; font-size: 18px; opacity: 0.6; }
        .medido-badge { background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 900; }
        .previsto-badge { background: #eff6ff; color: #1e40af; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 900; }
        .btn-toggle { font-size: 10px; font-weight: 900; text-transform: uppercase; padding: 6px 12px; border-radius: 10px; transition: all 0.2s; }
        .item-glow { filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.9)); }
        
        /* Toast Animado */
        #motive-toast { transition: all 0.5s ease; }
    </style>
</head>
<body class="pb-24">

    <!-- Toast de Mensagem Motivacional -->
    <div id="motive-toast" class="fixed bottom-24 left-4 right-4 z-[200] transform translate-y-full opacity-0 pointer-events-none">
        <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4 rounded-2xl shadow-2xl flex items-center gap-4 border-2 border-white/20 backdrop-blur-lg">
            <div class="bg-white/20 p-3 rounded-full">
                <i class="fas fa-heart text-2xl animate-beat"></i>
            </div>
            <p id="motive-text" class="font-black text-sm leading-tight"></p>
        </div>
    </div>

    <header class="bg-header text-white pb-20 pt-12 px-4 rounded-b-[4rem] text-center shadow-2xl relative">
        <div class="mb-4 flex justify-center items-center gap-4">
            <div class="relative">
                <i class="fas fa-user-friends text-5xl item-glow"></i>
                <i class="fas fa-sparkles absolute -top-2 -right-2 text-yellow-200 animate-pulse"></i>
            </div>
            <div class="relative">
                <i class="fas fa-building text-6xl text-white item-glow"></i>
                <i class="fas fa-star absolute -top-1 -left-2 text-white animate-bounce text-xs"></i>
            </div>
        </div>
        <h1 class="text-4xl font-black mb-1">Apzinho 92</h1>
        <p class="text-white/90 text-[10px] font-black uppercase mb-6 tracking-[0.2em]">Thamirinha & Felipinho</p>
        
        <div class="bg-white/10 backdrop-blur-md mx-auto max-w-sm py-4 px-6 rounded-[2rem] border border-white/20">
            <p class="text-[11px] font-extrabold text-white leading-tight">
                "Entrega o teu caminho ao Senhor; confia nele, e ele tudo far√°."<br>
                <span class="text-[9px] opacity-80">(Salmos 37:5)</span>
            </p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 -mt-12 space-y-8 relative z-10">
        
        <!-- Dashboard Principal: Investimento Total -->
        <div class="bg-white p-6 card-shadow border-t-8 border-green-500 text-center">
            <div class="flex justify-center items-center gap-2 mb-2">
                <i class="fas fa-vault text-green-500 text-lg"></i>
                <p class="text-[11px] font-black text-green-600 uppercase tracking-widest">Total Investido no Apzinho</p>
            </div>
            <h2 class="text-3xl font-black text-gray-800" id="dash-total-geral">R$ 0,00</h2>
            <p class="text-[9px] text-gray-400 font-bold mt-1 uppercase">(Entrada + Evolu√ß√£o + Anuais Pagos)</p>
        </div>

        <!-- Dashboards de Comparativo -->
        <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
            <!-- Cart√£o Entrada -->
            <div class="bg-white p-5 card-shadow border-b-4 border-pink-400">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fas fa-wallet text-pink-400 text-xs"></i>
                    <p class="text-[9px] font-black text-pink-400 uppercase">Entrada Paga</p>
                </div>
                <h2 class="text-lg font-black text-gray-800" id="dash-total-pago">R$ 0,00</h2>
                <div class="mt-2 pt-2 border-t border-pink-50 flex items-center gap-1">
                    <p class="text-[8px] font-bold text-gray-400 uppercase">Previsto:</p>
                    <p class="text-[10px] font-black text-pink-300" id="dash-entrada-previsto">R$ 37.733,85</p>
                </div>
            </div>

            <!-- Cart√£o Evolu√ß√£o -->
            <div class="bg-white p-5 card-shadow border-b-4 border-blue-400">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fas fa-hammer text-blue-400 text-xs"></i>
                    <p class="text-[9px] font-black text-blue-400 uppercase">Evo. Obra Paga</p>
                </div>
                <h2 class="text-lg font-black text-gray-800" id="dash-evo-pago">R$ 0,00</h2>
                <div class="mt-2 pt-2 border-t border-blue-50 flex items-center gap-1">
                    <p class="text-[8px] font-bold text-gray-400 uppercase">Previsto:</p>
                    <p class="text-[10px] font-black text-blue-300" id="dash-evo-previsto">R$ 10.567,14</p>
                </div>
            </div>

            <!-- Cart√£o Cofrinho -->
            <div class="bg-white p-5 card-shadow border-b-4 border-yellow-400">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fas fa-piggy-bank text-yellow-600 text-xs"></i>
                    <p class="text-[9px] font-black text-yellow-600 uppercase">No Cofrinho</p>
                </div>
                <h2 class="text-lg font-black text-gray-800" id="dash-poupanca">R$ 0,00</h2>
                <div class="mt-2 pt-2 border-t border-yellow-50">
                    <p class="text-[8px] font-bold text-yellow-600 uppercase">Reserva Estrat√©gica</p>
                </div>
            </div>

            <!-- Cart√£o Financiamento -->
            <div class="bg-white p-5 card-shadow border-b-4 border-purple-400">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fas fa-file-contract text-purple-400 text-xs"></i>
                    <p class="text-[9px] font-black text-purple-400 uppercase">Financiado</p>
                </div>
                <h2 class="text-lg font-black text-gray-800" id="dash-finan-total">R$ 0,00</h2>
                <div class="mt-2 pt-2 border-t border-purple-50">
                    <p class="text-[8px] font-bold text-purple-400 uppercase">Saldo Banc√°rio</p>
                </div>
            </div>
        </div>

        <!-- Progresso e Detalhes da Obra INTERATIVO -->
        <section id="obra" class="bg-white card-shadow p-8 border border-purple-100">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="font-black text-gray-700 text-sm uppercase mb-1">Status Oficial da Obra</h3>
                    <p class="text-[10px] text-gray-400">Arraste a barra para atualizar a medi√ß√£o!</p>
                </div>
                <div id="obra-perc" class="text-4xl font-black text-purple-600">0%</div>
            </div>
            
            <!-- Barra Interativa -->
            <div class="progress-container mb-6 group">
                <div id="obra-bar" class="progress-fill" style="width: 0%"></div>
                <input type="range" min="0" max="100" step="0.01" class="progress-input" id="obra-slider" oninput="window.updateObraPerc(this.value)">
                
                <!-- Overlay de indica√ß√£o visual -->
                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity">
                    <span class="text-[10px] font-black text-white bg-black/20 px-3 py-1 rounded-full uppercase">Toque e deslize</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-gray-100">
                <div class="space-y-3">
                    <div class="flex justify-between text-xs font-bold">
                        <span class="text-gray-400 uppercase">Apartamento:</span>
                        <span class="text-gray-700" id="detalhe-valor-ap">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-xs font-bold">
                        <span class="text-gray-400 uppercase">Financiado:</span>
                        <span class="text-purple-600" id="detalhe-valor-finan">R$ 0,00</span>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between text-xs font-bold">
                        <span class="text-gray-400 uppercase">Total Entrada:</span>
                        <span class="text-pink-500" id="detalhe-valor-entrada">R$ 37.733,85</span>
                    </div>
                    <div class="flex justify-between text-xs font-bold">
                        <span class="text-gray-400 uppercase">Restante Entrada:</span>
                        <span class="text-red-500" id="detalhe-restante-entrada">R$ 0,00</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Controle de Entrada -->
        <section id="entrada" class="bg-white card-shadow overflow-hidden border border-pink-50">
            <div class="p-5 bg-gradient-to-r from-pink-50 to-white flex justify-between items-center border-b border-pink-100">
                <div class="flex items-center gap-3">
                    <h4 class="font-black text-pink-600 text-[11px] uppercase tracking-wider">Controle de Entrada</h4>
                    <button onclick="window.toggleShowAllEntrada()" id="btn-show-entrada" class="btn-toggle text-pink-500 bg-pink-100/50 hover:bg-pink-100">
                        Ver mais
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-center">
                    <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-black">
                        <tr>
                            <th class="p-4 text-left pl-8">M√™s</th>
                            <th class="p-4">Pago</th>
                        </tr>
                    </thead>
                    <tbody id="table-entrada" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </section>

        <!-- Evolu√ß√£o de Obra -->
        <section id="evo" class="bg-white card-shadow overflow-hidden border border-blue-50">
            <div class="p-5 bg-gradient-to-r from-blue-50 to-white flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <h4 class="font-black text-blue-600 text-[11px] uppercase tracking-wider">Evolu√ß√£o de Obra</h4>
                    <button onclick="window.toggleShowAllEvo()" id="btn-show-evo" class="btn-toggle text-blue-500 bg-blue-100/50 hover:bg-blue-100">
                        Ver mais
                    </button>
                </div>
                <div class="text-[9px] text-blue-400 font-bold bg-blue-50 px-2 py-1 rounded uppercase">Estimado pelo √∫ltimo pago</div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-center">
                    <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-black">
                        <tr>
                            <th class="p-4 text-left pl-8">Etapa/Data</th>
                            <th class="p-4">% Etapa</th>
                            <th class="p-4">Valor</th>
                            <th class="p-4">Situa√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="table-obra-list" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </section>

        <!-- Anuais -->
        <section id="anuais" class="bg-white card-shadow p-6">
            <h3 class="font-black text-[11px] uppercase text-gray-400 mb-6 tracking-widest text-center">Parcelas Anuais</h3>
            <div id="anuais-list" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
        </section>

        <!-- Cofrinho -->
        <section id="cofrinho" class="bg-white card-shadow p-8 border-2 border-dashed border-yellow-300">
            <h3 class="font-black text-gray-700 text-sm uppercase mb-4">Poupan√ßa do Apzinho</h3>
            <div class="bg-yellow-50 p-6 rounded-3xl flex items-center gap-4 mb-4">
                <i class="fas fa-piggy-bank text-yellow-500 text-3xl"></i>
                <div class="flex-1">
                    <input type="number" id="input-cofrinho" step="0.01" onchange="window.updateCofrinho(this.value)" class="w-full text-3xl font-black bg-transparent text-yellow-700 border-b-2 border-yellow-200 focus:outline-none" placeholder="0,00">
                </div>
            </div>
            <div class="text-center">
                <p class="text-xs font-black text-yellow-600 italic uppercase">"O pouco com Deus torna-se muito."</p>
            </div>
        </section>
    </main>

    <nav class="floating-nav">
        <a href="#entrada"><i class="fas fa-wallet"></i></a>
        <a href="#evo"><i class="fas fa-chart-line"></i></a>
        <a href="#anuais"><i class="fas fa-calendar"></i></a>
        <a href="#cofrinho"><i class="fas fa-piggy-bank"></i></a>
    </nav>

    <script>
        const fmt = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0);

        function renderAll() {
            const data = window.getAppData();
            const cronograma = window.getCronograma();
            const { showAllEvo, showAllEntrada } = window.getShowStates();
            if(!data) return;

            // Vari√°veis de Soma
            let somaEntradaPaga = data.config.saldoInicial || 0;
            let somaEvoPaga = 0;
            let somaAnualPaga = 0;
            
            // Render Entrada
            const tEntrada = document.getElementById('table-entrada');
            tEntrada.innerHTML = '';
            document.getElementById('btn-show-entrada').textContent = showAllEntrada ? "Ver menos" : "Ver mais";

            data.payments.forEach((p, i) => {
                somaEntradaPaga += (p.entrada_pago || 0);
                if (!showAllEntrada && i > 3) return;
                tEntrada.innerHTML += `
                    <tr>
                        <td class="p-4 text-left pl-8 font-extrabold text-[12px]">${p.month}</td>
                        <td class="p-4"><input type="number" value="${p.entrada_pago}" onchange="window.updateField(${i}, 'entrada_pago', this.value)" class="input-editable text-pink-600"></td>
                    </tr>
                `;
            });

            // Render Evolu√ß√£o
            const tEvo = document.getElementById('table-obra-list');
            tEvo.innerHTML = '';
            document.getElementById('btn-show-evo').textContent = showAllEvo ? "Ver menos" : "Ver mais";

            // C√°lculo da M√©dia para proje√ß√£o din√¢mica
            const mesesPagos = cronograma.filter(c => c.pago);
            const totalPagoEvoHistorico = mesesPagos.reduce((acc, curr) => acc + curr.valorPago, 0);
            const totalPercMedidoHistorico = mesesPagos.reduce((acc, curr) => acc + curr.percMes, 0);
            const custoPorUmPorcento = totalPagoEvoHistorico / totalPercMedidoHistorico;

            cronograma.forEach((item, i) => {
                let valorEtapa = item.pago ? item.valorPago : (item.percMes * custoPorUmPorcento);
                if(item.pago) somaEvoPaga += valorEtapa;
                
                if (!showAllEvo && i > 3) return;
                const situacao = item.pago ? 'Paga' : 'Prevista';
                const badge = item.pago ? 'medido-badge' : 'previsto-badge';

                tEvo.innerHTML += `
                    <tr class="${item.pago ? 'bg-blue-50/50' : 'opacity-70'}">
                        <td class="p-4 text-left pl-8">
                            <p class="font-black text-[11px] text-gray-700">Etapa ${item.etapa}</p>
                            <p class="text-[10px] text-gray-400 font-bold">${item.data}</p>
                        </td>
                        <td class="p-4 font-black text-blue-500 text-[11px]">${item.percMes.toFixed(2)}%</td>
                        <td class="p-4 font-black text-gray-700 text-[12px]">${fmt(valorEtapa)}</td>
                        <td class="p-4"><span class="${badge}">${situacao}</span></td>
                    </tr>
                `;
            });

            // Render Anuais
            const aList = document.getElementById('anuais-list');
            aList.innerHTML = '';
            data.anuais.forEach((a, idx) => {
                if(a.pago) somaAnualPaga += a.valor;
                aList.innerHTML += `
                    <div onclick="window.toggleAnual(${idx})" class="p-4 rounded-2xl border-2 cursor-pointer transition-all ${a.pago ? 'bg-green-50 border-green-200' : 'bg-white border-gray-100'}">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-[9px] font-black uppercase text-gray-400">${a.label}</p>
                                <p class="text-sm font-black">${fmt(a.valor)}</p>
                            </div>
                            <i class="fas ${a.pago ? 'fa-check-circle text-green-600' : 'fa-circle text-gray-100'}"></i>
                        </div>
                    </div>
                `;
            });

            // Dashboards
            const totalGeralPago = somaEntradaPaga + somaEvoPaga + somaAnualPaga;
            document.getElementById('dash-total-geral').textContent = fmt(totalGeralPago);
            document.getElementById('dash-total-pago').textContent = fmt(somaEntradaPaga);
            document.getElementById('dash-entrada-previsto').textContent = fmt(data.config.totalEntrada);
            document.getElementById('dash-evo-pago').textContent = fmt(somaEvoPaga);
            document.getElementById('dash-evo-previsto').textContent = fmt(data.config.previstoEvo);
            document.getElementById('dash-poupanca').textContent = fmt(data.poupanca.valorAtual);
            document.getElementById('input-cofrinho').value = data.poupanca.valorAtual;
            document.getElementById('dash-finan-total').textContent = fmt(data.config.totalFinanciamento);

            // Detalhes da Obra
            const percObraReal = data.config.percObraMedido || 0; 
            document.getElementById('obra-perc').textContent = percObraReal.toFixed(2) + '%';
            document.getElementById('obra-bar').style.width = percObraReal + '%';
            document.getElementById('obra-slider').value = percObraReal;
            
            document.getElementById('detalhe-valor-ap').textContent = fmt(data.config.valorApartamento);
            document.getElementById('detalhe-valor-finan').textContent = fmt(data.config.totalFinanciamento);
            document.getElementById('detalhe-valor-entrada').textContent = fmt(data.config.totalEntrada);
            document.getElementById('detalhe-restante-entrada').textContent = fmt(data.config.totalEntrada - somaEntradaPaga);
        }
    </script>
</body>
</html>




